# Deploying Thriftify to Render

This guide will help you deploy the Thriftify application (both Backend and Frontend) to Render.

## Prerequisites

1. A [Render account](https://render.com)
2. A MongoDB database (MongoDB Atlas recommended)
3. A Cloudinary account for image uploads
4. Your code pushed to a GitHub/GitLab repository

## Deployment Steps

### 1. Push Your Code to GitHub

Make sure all your code is committed and pushed to a GitHub repository:

```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

### 2. Create a New Blueprint on Render

1. Log in to your [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" button and select "Blueprint"
3. Connect your GitHub/GitLab repository
4. Render will automatically detect the `render.yaml` file

### 3. Configure Environment Variables

Before deploying, you need to set up the following environment variables in Render:

#### Backend Service Environment Variables:
- `MONGODB_URI` - Your MongoDB connection string (from MongoDB Atlas)
- `CLOUDINARY_CLOUD_NAME` - Your Cloudinary cloud name
- `CLOUDINARY_API_KEY` - Your Cloudinary API key
- `CLOUDINARY_API_SECRET` - Your Cloudinary API secret
- `JWT_SECRET` - Will be auto-generated by Render
- `JWT_REFRESH_SECRET` - Will be auto-generated by Render
- `FRONTEND_URL` - Will be set to your frontend URL

#### Frontend Service Environment Variables:
- `VITE_API_URL` - Will be set to your backend URL

### 4. Update URLs After Deployment

After your services are deployed, you'll need to update the URLs:

1. Go to your backend service and copy the URL (e.g., `https://thriftify-backend.onrender.com`)
2. Update the `VITE_API_URL` environment variable in your frontend service
3. Go to your frontend service and copy the URL (e.g., `https://thriftify-frontend.onrender.com`)
4. Update the `FRONTEND_URL` environment variable in your backend service
5. Trigger a redeploy for both services

### 5. MongoDB Atlas Setup

If you don't have MongoDB Atlas set up:

1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a free cluster
3. Create a database user
4. Whitelist all IP addresses (0.0.0.0/0) for Render access
5. Get your connection string and add it to Render as `MONGODB_URI`

### 6. Cloudinary Setup

1. Go to [Cloudinary](https://cloudinary.com/)
2. Sign up for a free account
3. From your dashboard, get:
   - Cloud Name
   - API Key
   - API Secret
4. Add these to your Render backend service environment variables

## Alternative: Manual Deployment

If you prefer to deploy services individually:

### Backend (Web Service)

1. Click "New +" → "Web Service"
2. Connect your repository
3. Configure:
   - **Name**: thriftify-backend
   - **Root Directory**: Backend
   - **Runtime**: Node
   - **Build Command**: `npm install`
   - **Start Command**: `node app.js`
4. Add environment variables listed above

### Frontend (Static Site)

1. Click "New +" → "Static Site"
2. Connect your repository
3. Configure:
   - **Name**: thriftify-frontend
   - **Root Directory**: Frontend
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: dist
4. Add the `VITE_API_URL` environment variable

## CORS Configuration

Make sure your backend's CORS configuration includes your frontend URL. Check the `app.js` file for CORS settings.

## Important Notes

- **Free Tier**: Render's free tier spins down services after 15 minutes of inactivity. The first request after inactivity may take 30-60 seconds.
- **Database**: Make sure your MongoDB Atlas cluster allows connections from all IPs (0.0.0.0/0) or add Render's IP addresses.
- **Environment Variables**: Never commit `.env` files to your repository. Use Render's environment variable management.
- **Build Time**: First deployment may take 5-10 minutes.

## Troubleshooting

### Backend won't start
- Check environment variables are set correctly
- Check MongoDB connection string is valid
- Review build logs for errors

### Frontend can't connect to backend
- Verify `VITE_API_URL` is set correctly
- Check CORS configuration in backend
- Verify backend is running and accessible

### Database connection errors
- Whitelist 0.0.0.0/0 in MongoDB Atlas Network Access
- Verify connection string includes username and password
- Check database user has proper permissions

## Monitoring

- Monitor your services from the Render Dashboard
- Check logs for any errors
- Set up health checks (already configured in render.yaml)

## Support

For issues with:
- **Render**: [Render Documentation](https://render.com/docs)
- **MongoDB Atlas**: [MongoDB Documentation](https://docs.atlas.mongodb.com/)
- **Cloudinary**: [Cloudinary Documentation](https://cloudinary.com/documentation)
